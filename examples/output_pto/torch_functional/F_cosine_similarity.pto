// PTO Program: F_cosine_similarity
// Generated by PTO ISA Compiler

func @F_cosine_similarity(%input1: !pto.memref<gm,...,f32>, %input2: !pto.memref<gm,...,f32>, %output: !pto.memref<gm,...,f32>) {
  // Tile Declarations
  %x1 = alloc_tile : !pto.tile<8x8xf32>
  %x2 = alloc_tile : !pto.tile<8x8xf32>
  %dot_prod = alloc_tile : !pto.tile<8x8xf32>
  %x1_sq = alloc_tile : !pto.tile<8x8xf32>
  %x2_sq = alloc_tile : !pto.tile<8x8xf32>
  %dot_sum = alloc_tile : !pto.tile<8x1xf32>
  %x1_norm_sq = alloc_tile : !pto.tile<8x1xf32>
  %x2_norm_sq = alloc_tile : !pto.tile<8x1xf32>
  %x1_norm = alloc_tile : !pto.tile<8x1xf32>
  %x2_norm = alloc_tile : !pto.tile<8x1xf32>
  %norm_prod = alloc_tile : !pto.tile<8x1xf32>
  %result = alloc_tile : !pto.tile<8x1xf32>
  
  // Instructions
  %x1 = tload %input1[0, 0] : (!pto.memref<gm,...,f32>, index, index) -> !pto.tile<8x8xf32>
  %x2 = tload %input2[0, 0] : (!pto.memref<gm,...,f32>, index, index) -> !pto.tile<8x8xf32>
  %dot_prod = tmul %x1, %x2 : !pto.tile<8x8xf32>
  %dot_sum = trowsum %dot_prod : !pto.tile<8x8xf32> -> !pto.tile<8x1xf32>
  %x1_sq = tmul %x1, %x1 : !pto.tile<8x8xf32>
  %x2_sq = tmul %x2, %x2 : !pto.tile<8x8xf32>
  %x1_norm_sq = trowsum %x1_sq : !pto.tile<8x8xf32> -> !pto.tile<8x1xf32>
  %x2_norm_sq = trowsum %x2_sq : !pto.tile<8x8xf32> -> !pto.tile<8x1xf32>
  %x1_norm = tsqrt %x1_norm_sq : !pto.tile<8x1xf32>
  %x2_norm = tsqrt %x2_norm_sq : !pto.tile<8x1xf32>
  %norm_prod = tmul %x1_norm, %x2_norm : !pto.tile<8x1xf32>
  %norm_prod = tadds %norm_prod, %1e-08 : !pto.tile<8x1xf32>, f32
  %result = tdiv %dot_sum, %norm_prod : !pto.tile<8x1xf32>
  tstore %result, %output[0, 0]
  
  return
}